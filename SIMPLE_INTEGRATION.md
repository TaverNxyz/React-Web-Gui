
# Simple Integration Guide for React + .NET Windows Forms

## Overview

This guide explains the simplest way to embed your React application inside a Windows Forms application using WebView2.

## Step 1: Build Your React App

When you want to update your .NET application with the latest React UI:

```bash
# In your React project folder
npm run build
```

This creates a `dist` folder with all the static files (HTML, CSS, JS).

## Step 2: Copy Files to Your .NET Project

1. Copy all files from the `dist` folder
2. Paste them into your .NET project's `WebResources` folder
3. In Visual Studio, set these files to have "Build Action: Embedded Resource"
4. **IMPORTANT**: Make sure to maintain the exact same folder structure as in the `dist` folder
   - Keep the `assets` subfolder intact
   - Don't rename any files, especially those with hash-based names (like `index-DCSCUgQ-.css`)
   - Make sure to copy ALL files including the index.html file

![Set to Embedded Resource](https://docs.microsoft.com/en-us/dotnet/core/tutorials/media/publishing-with-visual-studio/embedded-resource.png)

## Step 3: Update Namespace in Resource Names

Resource names in .NET follow this pattern: `Namespace.FolderPath.Filename`

If your application's namespace is not `imperium.tech`, you need to:

1. Find all instances of `imperium.tech` in resource paths
2. Replace with your actual namespace
3. Check the WebViewManager.cs file where resources are loaded

For example, in WebViewManager.cs, update lines like:
```csharp
var indexHtml = ResourceHelper.GetEmbeddedResource("imperium.tech.WebResources.index.html");
```

## Step 4: Verify Embedded Resources

1. In Visual Studio, right-click on your project and select "Properties"
2. Go to the "Resources" section
3. Check that all files from the `WebResources` folder are listed
4. Ensure they have "Build Action: Embedded Resource"
5. You can also verify embedded resources by adding this code temporarily to check available resources:

```csharp
// Add this to a method to debug resources
var assembly = Assembly.GetExecutingAssembly();
var resourceNames = assembly.GetManifestResourceNames();
foreach (var name in resourceNames)
{
    Console.WriteLine(name);
}
```

## Step 5: Check Project References and Build Configuration

1. Make sure the project file (.csproj) correctly includes the WebResources folder as embedded resources
2. Add this to your .csproj file (inside an ItemGroup element):

```xml
<ItemGroup>
  <EmbeddedResource Include="WebResources\**\*" />
</ItemGroup>
```

3. Clean and rebuild your solution after adding any new files
4. Check that the build process is successful
5. Verify output folder has the compiled .exe or .dll file

## Step 6: Modify HTML Base Path

The HTML file generated by Vite might use relative paths that won't work in a WebView environment. 
You need to modify the `index.html` to ensure all resources are correctly loaded:

1. Open the `index.html` file in the `WebResources` folder
2. Add a `<base>` tag in the `<head>` section:
```html
<head>
    <base href="ms-local-stream:///" />
    <!-- other head content -->
</head>
```
3. Save the file and make sure it maintains its "Embedded Resource" build action

## Step 7: Build and Run

Simply build and run your .NET application. The WebView2 control will automatically:
1. Load your React application from the embedded resources
2. Display it in the Windows Forms window
3. Enable communication between React and .NET

## Updating Your App

When you make changes to your React application:
1. Build the React app again (npm run build)
2. Copy the new files to your .NET project's WebResources folder
   - **Pay special attention to files with hash-based names** - these will change with each build!
   - You may need to remove old hash-based files and add the new ones
3. Update resource references if necessary
4. Build and run your .NET application

## Troubleshooting

### Missing Resources
If you see errors like: `Error reading resource 'imperium.tech.WebResources.index.html'` or `Could not load embedded index.html`:

This means:
1. The WebView is trying to load a resource that doesn't exist or isn't properly embedded
2. Check that:
   - The file exists in your project's WebResources folder
   - The file has "Build Action: Embedded Resource" 
   - The namespace in the resource path matches your application's namespace
   - Make sure you added the index.html file to your project
   - The file path in `GetEmbeddedResource()` matches exactly how it appears in the project
   - In Visual Studio, check "Show All Files" to see if the file is actually in the project
   - Right-click and select "Include In Project" if files are visible but grayed out

### Be Extremely Careful About Visual Studio File Inclusion

Visual Studio sometimes shows files that are physically in the project folder but are NOT actually included in the project:

1. In Solution Explorer, click the "Show All Files" button at the top
2. Files that are in the folder but NOT in the project will appear grayed out
3. You MUST right-click on these files and select "Include In Project" for them to be compiled properly
4. After including them, set their Build Action to "Embedded Resource"
5. This is the #1 reason for "missing resource" errors!

### Debugging Embedded Resources
To see what resources are actually embedded in your application:

```csharp
// Add this to WebViewManager.Initialize() method for debugging
var assembly = Assembly.GetExecutingAssembly();
var resourceNames = assembly.GetManifestResourceNames();
foreach (var name in resourceNames)
{
    Console.WriteLine($"Found resource: {name}");
}

// Then check if your specific resource exists
bool indexExists = resourceNames.Contains("imperium.tech.WebResources.index.html");
Console.WriteLine($"Index HTML exists: {indexExists}");
```

### Check Build Directory

Make sure your build output contains the necessary resources:

1. Look in the `bin/Debug` or `bin/Release` folder of your project
2. Open the compiled .exe or .dll file with a tool like ILSpy or dotPeek
3. Check if the resources are included in the Resources section of the assembly
4. If not, revisit the steps above to ensure they are properly embedded

### Asset Path Issues
If styles or scripts aren't loading:
1. Inspect the browser console in WebView2 (right-click and select "Inspect" or "Developer Tools")
2. Look for 404 errors indicating missing resources
3. Check that the `<base>` tag is correctly set in your index.html
4. For direct resource loading, modify WebViewManager.cs to use WebView2's virtual host mapping

## Communication between React and .NET

The React app and .NET communicate via messages:
- React sends messages using the InteropService
- .NET receives messages in the WebView_WebMessageReceived method
- .NET sends responses back to React using SendResponseToWebView

This is already set up for you - no need to modify the communication code.
